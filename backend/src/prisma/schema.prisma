// File: src/prisma/schema.prisma
// Purpose: Define the relational data model for the English education backend using Prisma ORM.
// Why: Establishes the canonical database schema needed for initializing and migrating the PostgreSQL database.

generator client {
  provider      = "prisma-client"
  output        = "generated/client"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
}

model User {
  id            String         @id @default(uuid()) @db.Uuid
  email         String         @unique @db.Citext
  password      String?        @map("password_hash")
  fullName      String         @map("full_name")
  role          UserRole
  status        UserStatus
  courses       Course[]       @relation("CourseOwner")
  enrollments   Enrollment[]
  submissions   Submission[]   @relation("SubmissionStudent")
  grades        Grade[]        @relation("SubmissionGrader")
  notifications Notification[]
  notificationPreferences UserNotificationPreference[]
  files         File[]
  sessions      AuthSession[]
  identities    Identity[]
  auditLogs     AuditLog[]     @relation("AuditActor")
  dashboardWidgetPreferences UserDashboardWidgetPreference[]
  createdAt     DateTime       @default(now()) @db.Timestamptz
  updatedAt     DateTime       @updatedAt @db.Timestamptz
  deletedAt     DateTime?      @db.Timestamptz

  @@index([deletedAt, createdAt], map: "users_deletedAt_createdAt_idx")
  @@map("users")
}

model Course {
  id           String       @id @default(uuid()) @db.Uuid
  title        String
  description  String?
  learningOutcomes Json?    @map("learning_outcomes")
  structureSummary String?  @map("structure_summary")
  prerequisitesSummary String? @map("prerequisites_summary")
  scheduleJson Json?        @map("schedule_json")
  ownerId      String       @map("owner_teacher_id") @db.Uuid
  owner        User         @relation("CourseOwner", fields: [ownerId], references: [id])
  enrollments  Enrollment[]
  assignments  Assignment[]
  rubrics      Rubric[]
  createdAt    DateTime     @default(now()) @db.Timestamptz
  updatedAt    DateTime     @updatedAt @db.Timestamptz
  deletedAt    DateTime?    @db.Timestamptz

  @@index([deletedAt, createdAt], map: "courses_deletedAt_createdAt_idx")
  @@index([ownerId])
  @@map("courses")
}

model Enrollment {
  id           String         @id @default(uuid()) @db.Uuid
  courseId     String         @map("course_id") @db.Uuid
  userId       String         @map("user_id") @db.Uuid
  roleInCourse EnrollmentRole @map("role_in_course")
  course       Course         @relation(fields: [courseId], references: [id])
  user         User           @relation(fields: [userId], references: [id])
  createdAt    DateTime       @default(now()) @db.Timestamptz
  updatedAt    DateTime       @updatedAt @db.Timestamptz
  deletedAt    DateTime?      @db.Timestamptz

  @@unique([courseId, userId])
  @@index([userId, roleInCourse, deletedAt], map: "enrollments_user_id_role_in_course_deletedAt_idx")
  @@index([courseId, roleInCourse, deletedAt, createdAt], map: "enrollments_course_id_role_in_course_deletedAt_createdAt_idx")
  @@map("enrollments")
}

model Assignment {
  id          String         @id @default(uuid()) @db.Uuid
  courseId    String         @map("course_id") @db.Uuid
  title       String
  description String?        @map("description_md")
  type        AssignmentType
  dueAt       DateTime?      @map("due_at") @db.Timestamptz
  latePolicy  Json?          @map("late_policy")
  assignmentConfig Json?      @map("assignment_config")
  publishedAt DateTime?      @map("published_at") @db.Timestamptz
  course      Course         @relation(fields: [courseId], references: [id])
  submissions Submission[]
  createdAt   DateTime       @default(now()) @db.Timestamptz
  updatedAt   DateTime       @updatedAt @db.Timestamptz
  deletedAt   DateTime?      @db.Timestamptz

  @@index([courseId, deletedAt, createdAt], map: "assignments_course_id_deletedAt_createdAt_idx")
  @@index([courseId, dueAt])
  @@index([deletedAt, dueAt], map: "assignments_deletedAt_due_at_idx")
  @@map("assignments")
}

model Rubric {
  id        String    @id @default(uuid()) @db.Uuid
  courseId  String    @map("course_id") @db.Uuid
  name      String
  criteria  Json
  course    Course    @relation(fields: [courseId], references: [id])
  createdAt DateTime  @default(now()) @db.Timestamptz
  updatedAt DateTime  @updatedAt @db.Timestamptz
  deletedAt DateTime? @db.Timestamptz

  @@index([courseId, deletedAt, createdAt], map: "rubrics_course_id_deletedAt_createdAt_idx")
  @@index([courseId])
  @@map("rubrics")
}

model RubricTemplate {
  id             String   @id @default(uuid()) @db.Uuid
  name           String
  context        String
  assignmentType String   @map("assignment_type")
  criteria       Json
  isActive       Boolean  @default(true) @map("is_active")
  sortOrder      Int      @default(0) @map("sort_order")
  createdAt      DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt      DateTime @updatedAt @map("updated_at") @db.Timestamptz

  @@unique([context, assignmentType, name], map: "rubric_tpl_ctx_type_name_key")
  @@index([context, assignmentType, isActive, sortOrder], map: "rubric_tpl_ctx_type_active_sort_idx")
  @@map("rubric_templates")
}

model Submission {
  id           String           @id @default(uuid()) @db.Uuid
  assignmentId String           @map("assignment_id") @db.Uuid
  studentId    String           @map("student_id") @db.Uuid
  status       SubmissionStatus
  submittedAt  DateTime?        @map("submitted_at") @db.Timestamptz
  payload      Json
  assignment   Assignment       @relation(fields: [assignmentId], references: [id])
  student      User             @relation("SubmissionStudent", fields: [studentId], references: [id])
  grade        Grade?
  createdAt    DateTime         @default(now()) @db.Timestamptz
  updatedAt    DateTime         @updatedAt @db.Timestamptz
  deletedAt    DateTime?        @db.Timestamptz

  @@unique([assignmentId, studentId])
  @@index([assignmentId, deletedAt, createdAt], map: "submissions_assignment_id_deletedAt_createdAt_idx")
  @@index([assignmentId, status, deletedAt], map: "submissions_assignment_id_status_deletedAt_idx")
  @@index([studentId, status])
  @@map("submissions")
}

model Grade {
  id              String     @id @default(uuid()) @db.Uuid
  submissionId    String     @map("submission_id") @db.Uuid
  graderId        String     @map("grader_id") @db.Uuid
  rubricBreakdown Json?      @map("rubric_breakdown")
  rawScore        Decimal?   @map("raw_score") @db.Decimal(5, 2)
  adjustments     Json?
  finalScore      Decimal?   @map("final_score") @db.Decimal(5, 2)
  band            Decimal?   @map("band") @db.Decimal(3, 1)
  feedback        String?    @map("feedback_md")
  gradedAt        DateTime?  @map("graded_at") @db.Timestamptz
  submission      Submission @relation(fields: [submissionId], references: [id])
  grader          User       @relation("SubmissionGrader", fields: [graderId], references: [id])
  createdAt       DateTime   @default(now()) @db.Timestamptz
  updatedAt       DateTime   @updatedAt @db.Timestamptz
  deletedAt       DateTime?  @db.Timestamptz

  @@unique([submissionId])
  @@index([graderId, gradedAt])
  @@map("grades")
}

model Notification {
  id        String              @id @default(uuid()) @db.Uuid
  userId    String              @map("user_id") @db.Uuid
  type      String
  payload   Json
  channel   NotificationChannel
  status    NotificationStatus
  sentAt    DateTime?           @map("sent_at") @db.Timestamptz
  readAt    DateTime?           @map("read_at") @db.Timestamptz
  user      User                @relation(fields: [userId], references: [id])
  createdAt DateTime            @default(now()) @db.Timestamptz
  updatedAt DateTime            @updatedAt @db.Timestamptz
  deletedAt DateTime?           @db.Timestamptz

  @@index([userId, deletedAt, createdAt], map: "notifications_user_id_deletedAt_createdAt_idx")
  @@index([status, deletedAt, createdAt], map: "notifications_status_deletedAt_createdAt_idx")
  @@index([userId, readAt, deletedAt], map: "notifications_user_id_read_at_deletedAt_idx")
  @@index([userId, status, sentAt])
  @@map("notifications")
}

model NotificationTypeConfig {
  id             String   @id @default(uuid()) @db.Uuid
  role           UserRole
  type           String
  label          String
  description    String
  category       String
  defaultEnabled Boolean  @default(true) @map("default_enabled")
  enabled        Boolean  @default(true)
  sortOrder      Int      @default(0) @map("sort_order")
  createdAt      DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt      DateTime @updatedAt @map("updated_at") @db.Timestamptz

  @@unique([role, type], map: "notification_type_cfg_role_type_key")
  @@index([role, enabled, sortOrder], map: "notification_type_cfg_role_enabled_sort_idx")
  @@map("notification_type_configs")
}

model CourseManagementTabConfig {
  id                 String   @id @default(uuid()) @db.Uuid
  role               UserRole
  tabId              String   @map("tab_id")
  label              String
  icon               String
  requiredPermission String?  @map("required_permission")
  sortOrder          Int      @default(0) @map("sort_order")
  enabled            Boolean  @default(true)
  createdAt          DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt          DateTime @updatedAt @map("updated_at") @db.Timestamptz

  @@unique([role, tabId], map: "course_mgmt_tab_cfg_role_tab_key")
  @@index([role, enabled, sortOrder], map: "course_mgmt_tab_cfg_role_enabled_sort_idx")
  @@map("course_management_tab_configs")
}

model UserNotificationPreference {
  id        String   @id @default(uuid()) @db.Uuid
  userId    String   @map("user_id") @db.Uuid
  type      String
  enabled   Boolean  @default(true)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz

  @@unique([userId, type], map: "user_notification_prefs_user_type_key")
  @@index([userId, type, enabled], map: "user_notification_prefs_user_type_enabled_idx")
  @@map("user_notification_preferences")
}

model File {
  id        String    @id @default(uuid()) @db.Uuid
  ownerId   String    @map("owner_user_id") @db.Uuid
  bucket    String
  objectKey String    @map("key")
  mime      String
  size      Int
  checksum  String
  owner     User      @relation(fields: [ownerId], references: [id])
  createdAt DateTime  @default(now()) @db.Timestamptz
  updatedAt DateTime  @updatedAt @db.Timestamptz
  deletedAt DateTime? @db.Timestamptz

  @@index([ownerId])
  @@map("files")
}

model AuthSession {
  id               String    @id @default(uuid()) @db.Uuid
  userId           String    @map("user_id") @db.Uuid
  refreshTokenHash String    @map("refresh_token_hash")
  userAgent        String?   @map("user_agent")
  ipHash           String?   @map("ip_hash")
  expiresAt        DateTime  @map("expires_at") @db.Timestamptz
  revokedAt        DateTime? @map("revoked_at") @db.Timestamptz
  user             User      @relation(fields: [userId], references: [id])
  createdAt        DateTime  @default(now()) @db.Timestamptz
  updatedAt        DateTime  @updatedAt @db.Timestamptz
  deletedAt        DateTime? @db.Timestamptz

  @@index([refreshTokenHash, revokedAt], map: "auth_sessions_refresh_token_hash_revoked_at_idx")
  @@index([userId, expiresAt])
  @@map("auth_sessions")
}

model Identity {
  id              String           @id @default(uuid()) @db.Uuid
  userId          String           @map("user_id") @db.Uuid
  provider        IdentityProvider
  providerSubject String           @map("provider_subject")
  providerIssuer  String           @map("provider_issuer")
  email           String           @db.Citext
  emailVerified   Boolean          @map("email_verified")
  user            User             @relation(fields: [userId], references: [id])
  createdAt       DateTime         @default(now()) @db.Timestamptz
  updatedAt       DateTime         @updatedAt @db.Timestamptz
  deletedAt       DateTime?        @db.Timestamptz

  @@unique([provider, providerSubject])
  @@unique([providerIssuer, email])
  @@index([userId])
  @@map("identities")
}

model AuditLog {
  id        String    @id @default(uuid()) @db.Uuid
  actorId   String?   @map("actor_user_id") @db.Uuid
  action    String
  entity    String
  entityId  String    @map("entity_id")
  diff      Json?
  actor     User?     @relation("AuditActor", fields: [actorId], references: [id])
  createdAt DateTime  @default(now()) @db.Timestamptz
  updatedAt DateTime  @updatedAt @db.Timestamptz
  deletedAt DateTime? @db.Timestamptz

  @@index([deletedAt, createdAt, id], map: "audit_logs_deletedAt_createdAt_id_idx")
  @@index([actorId, createdAt])
  @@index([entity, entityId])
  @@map("audit_logs")
}

enum UserRole {
  admin
  teacher
  student
}

enum UserStatus {
  active
  invited
  suspended
}

enum EnrollmentRole {
  teacher
  student
}

enum AssignmentType {
  file
  link
  text
  quiz
  reading
  listening
  writing
  speaking
}

enum SubmissionStatus {
  draft
  submitted
  late
  graded
}

enum NotificationChannel {
  inapp
  email
  push
  sms
}

enum NotificationStatus {
  queued
  sent
  failed
  read
}

enum IdentityProvider {
  password
  google
}

// ============================================================================
// Navigation, Permissions & Feature Flags
// ============================================================================

model Permission {
  id          String   @id @default(uuid()) @db.Uuid
  key         String   @unique
  name        String
  description String?
  roles       RolePermission[]
  createdAt   DateTime @default(now()) @db.Timestamptz

  @@map("permissions")
}

model RolePermission {
  id           String     @id @default(uuid()) @db.Uuid
  role         UserRole
  permission   Permission @relation(fields: [permissionId], references: [id])
  permissionId String     @map("permission_id") @db.Uuid
  createdAt    DateTime   @default(now()) @db.Timestamptz

  @@unique([role, permissionId])
  @@map("role_permissions")
}

model NavigationItem {
  id                 String   @id @default(uuid()) @db.Uuid
  role               UserRole
  label              String
  path               String
  iconName           String   @map("icon_name")
  requiredPermission String?  @map("required_permission")
  orderIndex         Int      @default(0) @map("order_index")
  badgeSource        String?  @map("badge_source")
  parentId           String?  @map("parent_id") @db.Uuid
  parent             NavigationItem?  @relation("NavItemChildren", fields: [parentId], references: [id])
  children           NavigationItem[] @relation("NavItemChildren")
  isActive           Boolean  @default(true) @map("is_active")
  featureFlag        String?  @map("feature_flag")
  createdAt          DateTime @default(now()) @db.Timestamptz
  updatedAt          DateTime @updatedAt @db.Timestamptz

  @@index([role, isActive, orderIndex])
  @@map("navigation_items")
}

model FeatureFlag {
  id          String            @id @default(uuid()) @db.Uuid
  key         String            @unique
  name        String
  description String?
  enabled     Boolean           @default(false)
  roles       FeatureFlagRole[]
  createdAt   DateTime          @default(now()) @db.Timestamptz
  updatedAt   DateTime          @updatedAt @db.Timestamptz

  @@map("feature_flags")
}

model FeatureFlagRole {
  id            String      @id @default(uuid()) @db.Uuid
  featureFlag   FeatureFlag @relation(fields: [featureFlagId], references: [id])
  featureFlagId String      @map("feature_flag_id") @db.Uuid
  role          UserRole
  createdAt     DateTime    @default(now()) @db.Timestamptz

  @@unique([featureFlagId, role])
  @@map("feature_flag_roles")
}

// ============================================================================
// File Upload Configuration Models
// ============================================================================

model FileUploadPolicy {
  id                String                  @id @default(uuid()) @db.Uuid
  role              UserRole                @unique
  maxFileSize       Int                     @map("max_file_size")
  maxTotalSize      Int                     @map("max_total_size")
  maxFilesPerUpload Int                     @default(5) @map("max_files_per_upload")
  allowedTypes      FileUploadAllowedType[]
  createdAt         DateTime                @default(now()) @map("created_at") @db.Timestamptz
  updatedAt         DateTime                @updatedAt @map("updated_at") @db.Timestamptz

  @@map("file_upload_policies")
}

model FileUploadAllowedType {
  id          String           @id @default(uuid()) @db.Uuid
  policyId    String           @map("policy_id") @db.Uuid
  policy      FileUploadPolicy @relation(fields: [policyId], references: [id], onDelete: Cascade)
  mimeType    String           @map("mime_type")
  extensions  String[]
  label       String
  acceptToken String           @map("accept_token")
  sortOrder   Int              @default(0) @map("sort_order")
  createdAt   DateTime         @default(now()) @map("created_at") @db.Timestamptz
  updatedAt   DateTime         @updatedAt @map("updated_at") @db.Timestamptz

  @@index([policyId, sortOrder])
  @@map("file_upload_allowed_types")
}

// ============================================================================
// Dashboard Widget Configuration Models
// ============================================================================

model DashboardWidgetDefinition {
  id           String                          @id @default(uuid()) @db.Uuid
  role         UserRole
  widgetKey    String                          @map("widget_key")
  type         String
  label        String
  iconName     String                          @map("icon_name")
  color        String
  dataSource   String                          @map("data_source")
  valueFormat  String                          @map("value_format")
  defaultOrder Int                             @default(0) @map("default_order")
  defaultVisible Boolean                       @default(true) @map("default_visible")
  defaultX     Int                             @default(0) @map("default_x")
  defaultY     Int                             @default(0) @map("default_y")
  defaultW     Int                             @default(1) @map("default_w")
  defaultH     Int                             @default(1) @map("default_h")
  isActive     Boolean                         @default(true) @map("is_active")
  preferences  UserDashboardWidgetPreference[]
  createdAt    DateTime                        @default(now()) @map("created_at") @db.Timestamptz
  updatedAt    DateTime                        @updatedAt @map("updated_at") @db.Timestamptz

  @@unique([role, widgetKey], map: "dashboard_widget_defs_role_widget_key_key")
  @@index([role, isActive, defaultOrder], map: "dashboard_widget_defs_role_active_order_idx")
  @@map("dashboard_widget_definitions")
}

model UserDashboardWidgetPreference {
  id                 String                  @id @default(uuid()) @db.Uuid
  userId             String                  @map("user_id") @db.Uuid
  widgetDefinitionId String                  @map("widget_definition_id") @db.Uuid
  visible            Boolean                 @default(true)
  orderIndex         Int                     @map("order_index")
  x                  Int
  y                  Int
  w                  Int
  h                  Int
  user               User                    @relation(fields: [userId], references: [id], onDelete: Cascade)
  widgetDefinition   DashboardWidgetDefinition @relation(fields: [widgetDefinitionId], references: [id], onDelete: Cascade)
  createdAt          DateTime                @default(now()) @map("created_at") @db.Timestamptz
  updatedAt          DateTime                @updatedAt @map("updated_at") @db.Timestamptz

  @@unique([userId, widgetDefinitionId], map: "user_dashboard_widget_prefs_user_widget_key")
  @@index([userId, orderIndex], map: "user_dashboard_widget_prefs_user_order_idx")
  @@map("user_dashboard_widget_preferences")
}

// ============================================================================
// IELTS Domain Configuration Models
// ============================================================================

model IeltsConfigVersion {
  id            String   @id @default(uuid()) @db.Uuid
  version       Int      @unique
  name          String
  description   String?
  isActive      Boolean  @default(false) @map("is_active")
  activatedAt   DateTime? @map("activated_at") @db.Timestamptz
  createdAt     DateTime @default(now()) @map("created_at") @db.Timestamptz

  assignmentTypes      IeltsAssignmentType[]
  questionTypes        IeltsQuestionType[]
  writingTaskTypes     IeltsWritingTaskType[]
  speakingPartTypes    IeltsSpeakingPartType[]
  completionFormats    IeltsCompletionFormat[]
  sampleTimingOptions  IeltsSampleTimingOption[]
  questionOptions      IeltsQuestionOption[]

  @@map("ielts_config_versions")
}

model IeltsQuestionOption {
  id             String   @id @default(uuid()) @db.Uuid
  configVersion  Int      @map("config_version")
  optionType     String   @map("option_type") // 'true_false' or 'yes_no'
  value          String
  label          String
  score          Int      @default(0)
  enabled        Boolean  @default(true)
  sortOrder      Int      @default(0) @map("sort_order")
  createdAt      DateTime @default(now()) @map("created_at") @db.Timestamptz

  config IeltsConfigVersion @relation(fields: [configVersion], references: [version], onDelete: Cascade)

  @@unique([configVersion, optionType, value], map: "ielts_question_opts_cfg_type_value_key")
  @@index([configVersion, optionType, enabled, sortOrder], map: "ielts_question_opts_lookup_idx")
  @@map("ielts_question_options")
}

model IeltsAssignmentType {
  id             String   @id
  configVersion  Int      @map("config_version")
  label          String
  description    String?
  icon           String?
  enabled        Boolean  @default(true)
  sortOrder      Int      @default(0) @map("sort_order")
  createdAt      DateTime @default(now()) @map("created_at") @db.Timestamptz

  config IeltsConfigVersion @relation(fields: [configVersion], references: [version], onDelete: Cascade)

  @@unique([id, configVersion])
  @@map("ielts_assignment_types")
}

model IeltsQuestionType {
  id             String   @id
  configVersion  Int      @map("config_version")
  skillType      String   @map("skill_type") // 'reading' or 'listening'
  label          String
  description    String?
  enabled        Boolean  @default(true)
  sortOrder      Int      @default(0) @map("sort_order")
  createdAt      DateTime @default(now()) @map("created_at") @db.Timestamptz

  config IeltsConfigVersion @relation(fields: [configVersion], references: [version], onDelete: Cascade)

  @@unique([id, configVersion, skillType])
  @@map("ielts_question_types")
}

model IeltsWritingTaskType {
  id             String   @id
  configVersion  Int      @map("config_version")
  taskNumber     Int      @map("task_number") // 1 or 2
  label          String
  description    String?
  enabled        Boolean  @default(true)
  sortOrder      Int      @default(0) @map("sort_order")
  createdAt      DateTime @default(now()) @map("created_at") @db.Timestamptz

  config IeltsConfigVersion @relation(fields: [configVersion], references: [version], onDelete: Cascade)

  @@unique([id, configVersion, taskNumber])
  @@map("ielts_writing_task_types")
}

model IeltsSpeakingPartType {
  id             String   @id
  configVersion  Int      @map("config_version")
  label          String
  description    String?
  enabled        Boolean  @default(true)
  sortOrder      Int      @default(0) @map("sort_order")
  createdAt      DateTime @default(now()) @map("created_at") @db.Timestamptz

  config IeltsConfigVersion @relation(fields: [configVersion], references: [version], onDelete: Cascade)

  @@unique([id, configVersion])
  @@map("ielts_speaking_part_types")
}

model IeltsCompletionFormat {
  id             String   @id
  configVersion  Int      @map("config_version")
  label          String
  description    String?
  enabled        Boolean  @default(true)
  sortOrder      Int      @default(0) @map("sort_order")
  createdAt      DateTime @default(now()) @map("created_at") @db.Timestamptz

  config IeltsConfigVersion @relation(fields: [configVersion], references: [version], onDelete: Cascade)

  @@unique([id, configVersion])
  @@map("ielts_completion_formats")
}

model IeltsSampleTimingOption {
  id             String   @id
  configVersion  Int      @map("config_version")
  label          String
  description    String?
  enabled        Boolean  @default(true)
  sortOrder      Int      @default(0) @map("sort_order")
  createdAt      DateTime @default(now()) @map("created_at") @db.Timestamptz

  config IeltsConfigVersion @relation(fields: [configVersion], references: [version], onDelete: Cascade)

  @@unique([id, configVersion])
  @@map("ielts_sample_timing_options")
}

// CMS Content models
model CmsPageContent {
id  String   @id @default(uuid()) @db.Uuid
pageKey String @unique @map("page_key")
label String
isActive Boolean @default(true) @map("is_active")
createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz
sections CmsSection[]
@@map("cms_page_contents")
}

model CmsSection {
id String @id @default(uuid()) @db.Uuid
pageId String @map("page_id") @db.Uuid
sectionKey String @map("section_key") // 'hero', 'stats', 'features'
label String
sortOrder Int @default(0) @map("sort_order")
isActive Boolean @default(true) @map("is_active")
createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz
page CmsPageContent @relation(fields: [pageId], references: [id], onDelete: Cascade)
items CmsContentItem[]
@@unique([pageId, sectionKey])
@@index([pageId, sectionKey])
@@map("cms_sections")
}

model CmsContentItem {
id String @id @default(uuid()) @db.Uuid
sectionId String @map("section_id") @db.Uuid
itemKey String? @map("item_key") //optional identifier
sortOrder Int @default(0) @map("sort_order")
contentType String @map("content_type")
contentJson Json @map("content_json")
isActive Boolean @default(true) @map("is_active")
createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz
section CmsSection @relation(fields: [sectionId], references: [id], onDelete: Cascade)
@@index([sectionId, sortOrder, isActive])
@@map("cms_content_items")
}
